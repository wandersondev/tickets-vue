{"version":3,"file":"VCalendarWeekly.js","names":["VIconBtn","makeCalendarBaseProps","useCalendarBase","useTheme","computed","weekNumber","createDayList","createNativeLocaleFormatter","getDayIdentifier","validateNumber","defineComponent","getPrefixedEventHandlers","useRender","VCalendarWeekly","name","props","minWeeks","validate","default","monthFormat","Function","showWeek","Boolean","color","String","shortWeekdays","type","localeFirstDayOfYear","Number","showMonthOnFirst","shortMonths","hideHeader","setup","_ref","slots","attrs","base","theme","parsedMinWeeks","parseInt","days","minDays","value","parsedWeekdays","length","start","getStartOfWeek","parsedStart","end","getEndOfWeek","parsedEnd","times","today","weekdaySkips","MAX_SAFE_INTEGER","todayWeek","monthFormatter","locale","current","_tms","short","timeZone","month","isOutside","day","dayIdentifier","genHead","_createElementVNode","genHeadDays","header","map","genHeadDay","unshift","index","outside","present","undefined","_mergeProps","getColorProps","text","date","getRelativeClasses","weekdayFormatter","genWeeks","daysValue","weekDays","weeks","i","push","genWeek","slice","getWeekNumber","week","weekNodes","genDay","genWeekNumber","determineDay","year","events","nativeEvent","genDayLabel","genDayLabelButton","hasMonth","_createVNode","dayFormatter","_normalizeClass","themeClasses","e","preventDefault"],"sources":["../../../src/labs/VCalendar/VCalendarWeekly.tsx"],"sourcesContent":["// Components\nimport { VIconBtn } from '@/labs/VIconBtn'\n\n// Composables\nimport { makeCalendarBaseProps, useCalendarBase } from './composables/calendarBase'\nimport { useTheme } from '@/composables'\n\n// Utilities\nimport { computed } from 'vue'\nimport { weekNumber } from './util/dateTimeUtils'\nimport {\n  createDayList,\n  createNativeLocaleFormatter,\n  getDayIdentifier,\n  validateNumber,\n} from './util/timestamp'\nimport { defineComponent, getPrefixedEventHandlers, useRender } from '@/util'\n\n// Types\nimport type { PropType } from 'vue'\nimport type { CalendarFormatter, CalendarTimestamp } from './types'\n\nexport const VCalendarWeekly = defineComponent({\n  name: 'VCalendarWeekly',\n\n  props: {\n    minWeeks: {\n      validate: validateNumber,\n      default: 1,\n    },\n    monthFormat: Function as PropType<CalendarFormatter>,\n    showWeek: Boolean,\n    color: String,\n    shortWeekdays: {\n      type: Boolean,\n      default: true,\n    },\n    localeFirstDayOfYear: {\n      type: [String, Number],\n      default: 0,\n    },\n    showMonthOnFirst: {\n      type: Boolean,\n      default: true,\n    },\n    shortMonths: {\n      type: Boolean,\n      default: true,\n    },\n    hideHeader: Boolean,\n\n    ...makeCalendarBaseProps(),\n  },\n\n  setup (props, { slots, attrs }) {\n    const base = useCalendarBase(props)\n\n    const theme = useTheme()\n\n    const parsedMinWeeks = computed((): number => {\n      return parseInt(String(props.minWeeks))\n    })\n\n    const days = computed((): CalendarTimestamp[] => {\n      const minDays = parsedMinWeeks.value * base.parsedWeekdays.value.length\n      const start = base.getStartOfWeek(base.parsedStart.value)\n      const end = base.getEndOfWeek(base.parsedEnd.value)\n\n      return createDayList(\n        start,\n        end,\n        base.times.today,\n        base.weekdaySkips.value,\n        Number.MAX_SAFE_INTEGER,\n        minDays\n      )\n    })\n\n    const todayWeek = computed((): CalendarTimestamp[] => {\n      const today = base.times.today\n      const start = base.getStartOfWeek(today)\n      const end = base.getEndOfWeek(today)\n\n      return createDayList(\n        start,\n        end,\n        today,\n        base.weekdaySkips.value,\n        base.parsedWeekdays.value.length,\n        base.parsedWeekdays.value.length\n      )\n    })\n\n    const monthFormatter = computed((): CalendarFormatter => {\n      if (props.monthFormat) {\n        // TODO: what happens when this is a string?\n        return props.monthFormat as CalendarFormatter\n      }\n\n      return createNativeLocaleFormatter(\n        base.locale.current.value,\n        (_tms, short) => ({ timeZone: 'UTC', month: short ? 'short' : 'long' })\n      )\n    })\n\n    function isOutside (day: CalendarTimestamp): boolean {\n      const dayIdentifier = getDayIdentifier(day)\n\n      return dayIdentifier < getDayIdentifier(base.parsedStart.value) ||\n             dayIdentifier > getDayIdentifier(base.parsedEnd.value)\n    }\n\n    function genHead () {\n      return (\n        <div class=\"v-calendar-weekly__head\" role=\"row\">\n          { genHeadDays() }\n        </div>\n      )\n    }\n\n    function genHeadDays () {\n      const header = todayWeek.value.map(genHeadDay)\n\n      if (props.showWeek) {\n        header.unshift(\n          <div class=\"v-calendar-weekly__head-weeknumber\" />\n        )\n      }\n\n      return header\n    }\n\n    function genHeadDay (day: CalendarTimestamp, index: number) {\n      const outside = isOutside(days.value[index])\n      const color = day.present ? props.color : undefined\n\n      return (\n        <div\n          { ...base.getColorProps({ text: color }) }\n          key={ day.date }\n          class={['v-calendar-weekly__head-weekday', base.getRelativeClasses(day, outside)]}\n          role=\"columnheader\"\n        >\n          { base.weekdayFormatter.value(day, props.shortWeekdays) }\n        </div>\n      )\n    }\n\n    function genWeeks () {\n      const daysValue = days.value\n      const weekDays = base.parsedWeekdays.value.length\n      const weeks: any[] = []\n\n      for (let i = 0; i < daysValue.length; i += weekDays) {\n        weeks.push(genWeek(daysValue.slice(i, i + weekDays), getWeekNumber(daysValue[i])))\n      }\n\n      return weeks\n    }\n\n    function genWeek (week: CalendarTimestamp[], weekNumber: number) {\n      const weekNodes = week.map((day, index) => genDay(day, index, week))\n\n      if (props.showWeek) {\n        weekNodes.unshift(genWeekNumber(weekNumber))\n      }\n\n      return (\n        <div\n          key={ week[0].date }\n          class=\"v-calendar-weekly__week\"\n          role=\"row\"\n        >\n          { weekNodes }\n        </div>\n      )\n    }\n\n    function getWeekNumber (determineDay: CalendarTimestamp) {\n      return weekNumber(\n        determineDay.year,\n        determineDay.month - 1,\n        determineDay.day,\n        base.parsedWeekdays.value[0],\n        parseInt(String(props.localeFirstDayOfYear))\n      )\n    }\n\n    function genWeekNumber (weekNumber: number) {\n      return (\n        <div class=\"v-calendar-weekly__weeknumber\">\n          <small>{ String(weekNumber) }</small>\n        </div>\n      )\n    }\n\n    function genDay (day: CalendarTimestamp, index: number, week: CalendarTimestamp[]) {\n      const outside = isOutside(day)\n      const events = getPrefixedEventHandlers(attrs, ':day', nativeEvent => {\n        return { nativeEvent, ...day }\n      })\n\n      return (\n        <div\n          key={ day.date }\n          class={['v-calendar-weekly__day', base.getRelativeClasses(day, outside)]}\n          role=\"cell\"\n          { ...events }\n        >\n          { genDayLabel(day) }\n          { slots.day?.({ outside, index, week, ...day }) }\n        </div>\n      )\n    }\n\n    function genDayLabel (day: CalendarTimestamp) {\n      return (\n        <div class=\"v-calendar-weekly__day-label\">\n          { slots['day-label']?.(day) ?? genDayLabelButton(day) }\n        </div>\n      )\n    }\n\n    function genDayLabelButton (day: CalendarTimestamp) {\n      const hasMonth = day.day === 1 && props.showMonthOnFirst\n      const events = getPrefixedEventHandlers(attrs, ':date', nativeEvent => ({ nativeEvent, ...day }))\n\n      return (\n        <VIconBtn\n          active={ day.present }\n          activeColor={ props.color }\n          variant={ props.color ? 'flat' : 'tonal' }\n          baseVariant=\"text\"\n          { ...events }\n        >\n          { hasMonth\n            ? monthFormatter.value(day, props.shortMonths) + ' ' + base.dayFormatter.value(day, false)\n            : base.dayFormatter.value(day, false)\n          }\n        </VIconBtn>\n      )\n    }\n\n    useRender(() => (\n      <div\n        class={['v-calendar-weekly', theme.themeClasses.value]}\n        onDragstart={ (e: MouseEvent) => e.preventDefault() }\n      >\n        { !props.hideHeader ? genHead() : undefined }\n        { genWeeks() }\n      </div>\n    ))\n\n    return {\n      ...base,\n      days,\n      todayWeek,\n      monthFormatter,\n      isOutside,\n    }\n  },\n})\n\nexport type VCalendarWeekly = InstanceType<typeof VCalendarWeekly>\n"],"mappings":"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","ignoreList":[]}