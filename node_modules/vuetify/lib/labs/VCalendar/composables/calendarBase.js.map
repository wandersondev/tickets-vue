{"version":3,"file":"calendarBase.js","names":["useTimes","computeColor","provideLocale","computed","createDayList","createNativeLocaleFormatter","getEndOfMonth","getEndOfWeek","getStartOfMonth","getStartOfWeek","getTimestampIdentifier","getWeekdaySkips","parseDate","parseTimestamp","validateTimestamp","validateWeekdays","propsFactory","makeCalendarBaseProps","start","type","String","Number","Date","validate","default","date","end","weekdays","Array","weekdayFormat","Function","dayFormat","locale","now","validator","useCalendarBase","props","times","parsedStart","parsedEnd","value","parsedValue","modelValue","today","parsedWeekdays","isArray","split","map","x","parseInt","effectiveWeekdays","days","categoryDays","weekday","from","length","_","i","weekdaySkips","dayFormatter","current","timeZone","day","weekdayFormatter","_tms","short","getColorProps","colors","getRelativeClasses","timestamp","outside","arguments","undefined","present","past","future","_getStartOfWeek","_getEndOfWeek","getFormatter","options"],"sources":["../../../../src/labs/VCalendar/composables/calendarBase.ts"],"sourcesContent":["// Composables\nimport { useTimes } from './times'\nimport { computeColor } from '@/composables/color'\nimport { provideLocale } from '@/composables/locale'\n\n// Utilities\nimport { computed } from 'vue'\nimport {\n  createDayList,\n  createNativeLocaleFormatter, getEndOfMonth,\n  getEndOfWeek, getStartOfMonth,\n  getStartOfWeek,\n  getTimestampIdentifier,\n  getWeekdaySkips,\n  parseDate,\n  parseTimestamp,\n  validateTimestamp,\n  validateWeekdays,\n} from '../util/timestamp'\nimport { propsFactory } from '@/util'\n\n// Types\nimport type { PropType } from 'vue'\nimport type { CalendarFormatter, CalendarTimestamp } from '../types'\nimport type { ColorValue } from '@/composables/color'\n\nexport const makeCalendarBaseProps = propsFactory({\n  start: {\n    type: [String, Number, Date],\n    validate: validateTimestamp,\n    default: () => parseDate(new Date()).date,\n  },\n  end: {\n    type: [String, Number, Date],\n    validate: validateTimestamp,\n  },\n  weekdays: {\n    type: [Array, String] as PropType<number[] | string>,\n    default: () => [0, 1, 2, 3, 4, 5, 6],\n    validate: validateWeekdays,\n  },\n  weekdayFormat: {\n    type: Function as PropType<CalendarFormatter>,\n    default: null,\n  },\n  dayFormat: {\n    type: Function as PropType<CalendarFormatter>,\n    default: null,\n  },\n  locale: String,\n  now: {\n    type: String,\n    validator: validateTimestamp,\n  },\n  type: {\n    type: String as PropType<'month' | 'week' | 'day' | '4day' | 'custom-weekly' | 'custom-daily' | 'category'>,\n    default: 'month',\n  },\n}, 'VCalendar-base')\n\nexport interface CalendarBaseProps {\n  modelValue?: string | number | Date\n  categoryDays?: string | number\n  start: string | number | Date\n  end: string | number | Date | undefined\n  weekdays: string | number[]\n  weekdayFormat: CalendarFormatter | string | undefined\n  dayFormat: CalendarFormatter | string | undefined\n  locale: string | undefined\n  now: string | undefined\n  type: 'month' | 'week' | 'day' | '4day' | 'custom-weekly' | 'custom-daily' | 'category'\n}\n\nexport function useCalendarBase (props: CalendarBaseProps) {\n  const { times } = useTimes({ now: props.now })\n  const locale = provideLocale(props)\n\n  const parsedStart = computed((): CalendarTimestamp => {\n    if (props.type === 'month') {\n      return getStartOfMonth(parseTimestamp(props.start, true))\n    }\n    return parseTimestamp(props.start, true)\n  })\n\n  const parsedEnd = computed((): CalendarTimestamp => {\n    const start = parsedStart.value\n    const end: CalendarTimestamp = props.end ? parseTimestamp(props.end) || start : start\n    const value = getTimestampIdentifier(end) < getTimestampIdentifier(start) ? start : end\n\n    if (props.type === 'month') {\n      return getEndOfMonth(value)\n    }\n    return value\n  })\n\n  const parsedValue = computed((): CalendarTimestamp => {\n    return (validateTimestamp(props.modelValue)\n      ? parseTimestamp(props.modelValue, true)\n      : (parsedStart.value || times.today))\n  })\n\n  const parsedWeekdays = computed((): number[] => {\n    return Array.isArray(props.weekdays)\n      ? props.weekdays\n      : (props.weekdays || '').split(',').map(x => parseInt(x, 10))\n  })\n\n  const effectiveWeekdays = computed((): number[] => {\n    const start = parsedValue.value\n    const days = parseInt(String(props.categoryDays)) || 1\n\n    switch (props.type) {\n      case 'day': return [start.weekday]\n      case '4day': return [\n        start.weekday,\n        (start.weekday + 1) % 7,\n        (start.weekday + 2) % 7,\n        (start.weekday + 3) % 7,\n      ]\n      case 'category': return Array.from({ length: days }, (_, i) => (start.weekday + i) % 7)\n      default: return parsedWeekdays.value\n    }\n  })\n\n  const weekdaySkips = computed((): number[] => {\n    return getWeekdaySkips(parsedWeekdays.value)\n  })\n\n  const days = computed((): CalendarTimestamp[] => {\n    return createDayList(\n      parsedStart.value,\n      parsedEnd.value,\n      times.today,\n      weekdaySkips.value,\n    )\n  })\n\n  const dayFormatter = computed((): CalendarFormatter => {\n    if (props.dayFormat) {\n      return props.dayFormat as CalendarFormatter\n    }\n\n    return createNativeLocaleFormatter(\n      locale.current.value,\n      () => ({ timeZone: 'UTC', day: 'numeric' })\n    )\n  })\n\n  const weekdayFormatter = computed((): CalendarFormatter => {\n    if (props.weekdayFormat) {\n      return props.weekdayFormat as CalendarFormatter\n    }\n\n    return createNativeLocaleFormatter(\n      locale.current.value,\n      (_tms, short) => ({ timeZone: 'UTC', weekday: short ? 'short' : 'long' })\n    )\n  })\n\n  function getColorProps (colors: { background?: ColorValue, text?: ColorValue }) {\n    return computeColor(colors)\n  }\n\n  function getRelativeClasses (timestamp: CalendarTimestamp, outside = false) {\n    return {\n      'v-present': timestamp.present,\n      'v-past': timestamp.past,\n      'v-future': timestamp.future,\n      'v-outside': outside,\n    }\n  }\n\n  function _getStartOfWeek (timestamp: CalendarTimestamp): CalendarTimestamp {\n    return getStartOfWeek(timestamp, parsedWeekdays.value, times.today)\n  }\n\n  function _getEndOfWeek (timestamp: CalendarTimestamp): CalendarTimestamp {\n    return getEndOfWeek(timestamp, parsedWeekdays.value, times.today)\n  }\n\n  function getFormatter (options: Intl.DateTimeFormatOptions): CalendarFormatter {\n    return createNativeLocaleFormatter(locale.current.value, () => options)\n  }\n\n  return {\n    times,\n    locale,\n    parsedValue,\n    parsedWeekdays,\n    effectiveWeekdays,\n    weekdaySkips,\n    parsedStart,\n    parsedEnd,\n    days,\n    dayFormatter,\n    weekdayFormatter,\n    getColorProps,\n    getRelativeClasses,\n    getStartOfWeek: _getStartOfWeek,\n    getEndOfWeek: _getEndOfWeek,\n    getFormatter,\n  }\n}\n"],"mappings":"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","ignoreList":[]}