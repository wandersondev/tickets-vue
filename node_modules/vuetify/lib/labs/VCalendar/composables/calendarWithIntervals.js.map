{"version":3,"file":"calendarWithIntervals.js","names":["useCalendarBase","computed","shallowRef","copyTimestamp","createDayList","createIntervalList","createNativeLocaleFormatter","MINUTES_IN_DAY","parseTime","updateMinutes","validateNumber","validateTime","propsFactory","makeCalendarWithIntervalsProps","maxDays","type","Number","default","intervalHeight","String","validate","intervalWidth","intervalMinutes","firstInterval","firstTime","Object","intervalCount","intervalFormat","Function","intervalStyle","showIntervalLabel","useCalendarWithIntervals","props","base","scrollAreaRef","parsedFirstInterval","parseInt","parsedIntervalMinutes","parsedIntervalCount","parsedIntervalHeight","parseFloat","parsedFirstTime","firstMinute","time","value","bodyHeight","days","parsedStart","parsedEnd","times","today","weekdaySkips","intervals","daysValue","first","minutes","count","now","map","d","intervalFormatter","locale","current","tms","short","timeZone","hour","minute","showIntervalLabelDefault","interval","isFirst","intervalStyleDefault","_interval","undefined","getTimestampAtEvent","e","day","timestamp","bounds","currentTarget","getBoundingClientRect","baseMinutes","touchEvent","mouseEvent","touches","changedTouches","clientY","addIntervals","top","addMinutes","Math","floor","getSlotScope","scope","timeToY","timeDelta","minutesToPixels","week","scrollToTime","y","pane","scrollTop","clamp","arguments","length","min","gap"],"sources":["../../../../src/labs/VCalendar/composables/calendarWithIntervals.ts"],"sourcesContent":["// Composables\nimport { useCalendarBase } from './calendarBase'\n\n// Utilities\nimport { computed, shallowRef } from 'vue'\nimport {\n  copyTimestamp,\n  createDayList,\n  createIntervalList,\n  createNativeLocaleFormatter,\n  MINUTES_IN_DAY,\n  parseTime,\n  updateMinutes,\n  validateNumber,\n  validateTime,\n} from '../util/timestamp'\nimport { propsFactory } from '@/util'\n\n// Types\nimport type { PropType, StyleValue } from 'vue'\nimport type { CalendarBaseProps } from './calendarBase'\nimport type { CalendarDayBodySlotScope, CalendarFormatter, CalendarTimestamp } from '../types'\nimport type { VTime } from '../util/timestamp'\n\nexport const makeCalendarWithIntervalsProps = propsFactory({\n  maxDays: {\n    type: Number,\n    default: 7,\n  },\n  intervalHeight: {\n    type: [Number, String],\n    default: 48,\n    validate: validateNumber,\n  },\n  intervalWidth: {\n    type: [Number, String],\n    default: 60,\n    validate: validateNumber,\n  },\n  intervalMinutes: {\n    type: [Number, String],\n    default: 60,\n    validate: validateNumber,\n  },\n  firstInterval: {\n    type: [Number, String],\n    default: 0,\n    validate: validateNumber,\n  },\n  firstTime: {\n    type: [Number, String, Object] as PropType<VTime>,\n    validate: validateTime,\n  },\n  intervalCount: {\n    type: [Number, String],\n    default: 24,\n    validate: validateNumber,\n  },\n  intervalFormat: {\n    type: Function as PropType<CalendarFormatter>,\n    default: null,\n  },\n  intervalStyle: {\n    type: Function as PropType<(interval: CalendarTimestamp) => StyleValue>,\n    default: null,\n  },\n  showIntervalLabel: {\n    type: Function as PropType<(interval: CalendarTimestamp) => boolean>,\n    default: null,\n  },\n}, 'VCalendar-intervals')\n\ninterface CalendarWithIntervalsProps extends CalendarBaseProps {\n  maxDays: number\n  intervalHeight: string | number\n  intervalMinutes: string | number\n  firstInterval: string | number\n  firstTime: VTime | undefined\n  intervalCount: string | number\n  intervalFormat: CalendarFormatter | string | undefined\n}\n\nexport function useCalendarWithIntervals (props: CalendarWithIntervalsProps) {\n  const base = useCalendarBase(props)\n\n  const scrollAreaRef = shallowRef<HTMLElement>()\n\n  const parsedFirstInterval = computed((): number => {\n    return parseInt(String(props.firstInterval || 0))\n  })\n\n  const parsedIntervalMinutes = computed((): number => {\n    return parseInt(String(props.intervalMinutes || 60))\n  })\n\n  const parsedIntervalCount = computed((): number => {\n    return parseInt(String(props.intervalCount || 24))\n  })\n\n  const parsedIntervalHeight = computed((): number => {\n    return parseFloat(String(props.intervalHeight || 48))\n  })\n\n  const parsedFirstTime = computed((): number | false => {\n    return parseTime(props.firstTime)\n  })\n\n  const firstMinute = computed((): number => {\n    const time = parsedFirstTime.value\n\n    return time !== false && time >= 0 && time <= MINUTES_IN_DAY\n      ? time\n      : parsedFirstInterval.value * parsedIntervalMinutes.value\n  })\n\n  const bodyHeight = computed((): number => {\n    return parsedIntervalCount.value * parsedIntervalHeight.value\n  })\n\n  const days = computed((): CalendarTimestamp[] => {\n    return createDayList(\n      base.parsedStart.value,\n      base.parsedEnd.value,\n      base.times.today,\n      base.weekdaySkips.value,\n      props.maxDays\n    )\n  })\n\n  const intervals = computed((): CalendarTimestamp[][] => {\n    const daysValue = days.value\n    const first: number = firstMinute.value\n    const minutes: number = parsedIntervalMinutes.value\n    const count: number = parsedIntervalCount.value\n    const now: CalendarTimestamp = base.times.now\n\n    return daysValue.map(d => createIntervalList(d, first, minutes, count, now))\n  })\n\n  const intervalFormatter = computed((): CalendarFormatter => {\n    if (props.intervalFormat) {\n      return props.intervalFormat as CalendarFormatter\n    }\n\n    return createNativeLocaleFormatter(\n      base.locale.current.value,\n      (tms, short) => (\n        !short ? { timeZone: 'UTC', hour: '2-digit', minute: '2-digit' }\n        : tms.minute === 0 ? { timeZone: 'UTC', hour: 'numeric' }\n        : { timeZone: 'UTC', hour: 'numeric', minute: '2-digit' }\n      )\n    )\n  })\n\n  function showIntervalLabelDefault (interval: CalendarTimestamp): boolean {\n    const first: CalendarTimestamp = intervals.value[0][0]\n    const isFirst: boolean = first.hour === interval.hour && first.minute === interval.minute\n    return !isFirst\n  }\n\n  function intervalStyleDefault (_interval: CalendarTimestamp): StyleValue {\n    return undefined\n  }\n\n  function getTimestampAtEvent (e: Event, day: CalendarTimestamp): CalendarTimestamp {\n    const timestamp: CalendarTimestamp = copyTimestamp(day)\n    const bounds = (e.currentTarget as HTMLElement).getBoundingClientRect()\n    const baseMinutes: number = firstMinute.value\n    const touchEvent: TouchEvent = e as TouchEvent\n    const mouseEvent: MouseEvent = e as MouseEvent\n    const touches: TouchList = touchEvent.changedTouches || touchEvent.touches\n    const clientY: number = touches && touches[0] ? touches[0].clientY : mouseEvent.clientY\n    const addIntervals: number = (clientY - bounds.top) / parsedIntervalHeight.value\n    const addMinutes: number = Math.floor(addIntervals * parsedIntervalMinutes.value)\n    const minutes: number = baseMinutes + addMinutes\n\n    return updateMinutes(timestamp, minutes, base.times.now)\n  }\n\n  function getSlotScope (timestamp: CalendarTimestamp): CalendarDayBodySlotScope {\n    const scope = copyTimestamp(timestamp) as any\n    scope.timeToY = timeToY\n    scope.timeDelta = timeDelta\n    scope.minutesToPixels = minutesToPixels\n    scope.week = days.value\n    return scope\n  }\n\n  function scrollToTime (time: VTime): boolean {\n    const y = timeToY(time)\n\n    const pane = scrollAreaRef.value\n\n    if (y === false || !pane) {\n      return false\n    }\n\n    pane.scrollTop = y\n\n    return true\n  }\n\n  function minutesToPixels (minutes: number): number {\n    return minutes / parsedIntervalMinutes.value * parsedIntervalHeight.value\n  }\n\n  function timeToY (time: VTime, clamp = true): number | false {\n    let y = timeDelta(time)\n\n    if (y !== false) {\n      y *= bodyHeight.value\n\n      if (clamp) {\n        if (y < 0) {\n          y = 0\n        }\n        if (y > bodyHeight.value) {\n          y = bodyHeight.value\n        }\n      }\n    }\n\n    return y\n  }\n\n  function timeDelta (time: VTime): number | false {\n    const minutes = parseTime(time)\n\n    if (minutes === false) {\n      return false\n    }\n\n    const min: number = firstMinute.value\n    const gap: number = parsedIntervalCount.value * parsedIntervalMinutes.value\n\n    return (minutes - min) / gap\n  }\n\n  return {\n    ...base,\n    scrollAreaRef,\n    parsedFirstInterval,\n    parsedIntervalMinutes,\n    parsedIntervalCount,\n    parsedIntervalHeight,\n    parsedFirstTime,\n    firstMinute,\n    bodyHeight,\n    days,\n    intervals,\n    intervalFormatter,\n    showIntervalLabelDefault,\n    intervalStyleDefault,\n    getTimestampAtEvent,\n    getSlotScope,\n    scrollToTime,\n    minutesToPixels,\n    timeToY,\n    timeDelta,\n  }\n}\n"],"mappings":"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","ignoreList":[]}